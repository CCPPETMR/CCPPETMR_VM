{
  "variables": {
      "ssh_user": "sirfuser",
      "ssh_pass": "virtual"
},
"builders": [{
    "type": "azure-arm",

    "client_id": "{{ user `azure_client_id` }}",
    "client_secret": "{{ user `azure_client_secret` }}",
    "tenant_id": "{{ user `azure_tenant_id` }}",
    "subscription_id": "{{ user `azure_subscription` }}",

    "managed_image_resource_group_name": "{{ user `azure_rg_name` }}",
    "managed_image_name": "packerImage",
    "managed_image_storage_account_type": "Premium_LRS",

    "os_type": "Linux",
    "image_publisher": "Canonical",
    "image_offer": "UbuntuServer",
    "image_sku": "16.04.0-LTS",

    "location": "UK South",
    "vm_size": "Standard_DS3_v2_Promo",

    "ssh_username": "{{user `ssh_user`}}",
    "ssh_password": "{{user `ssh_pass`}}"
  }],
  "provisioners": [
      {
          "type": "file",
          "source": "provision.sh",
          "destination": "/tmp/provision.sh"
      },
      {
        "type": "file",
        "source": "jupyter.service",
        "destination": "/tmp/jupyter.service"
      },
      {
        "type": "file",
        "source": "launch.sh",
        "destination": "/tmp/launch.sh"
      },
      {
        "execute_command": "echo '{{user `ssh_pass`}}' ; chmod +x {{ .Path }}; {{ .Vars }} sudo -E sh '{{ .Path }}'",
        "inline": [
          "bash /tmp/provision.sh",
          "sudo systemctl enable jupyter.service",
          "/usr/sbin/waagent -force -deprovision && export HISTSIZE=0 && sync"
        ],
        "inline_shebang": "/bin/sh -x",
        "type": "shell"
      }
]
}
